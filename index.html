<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SHADOW WATCH // NEXUS-15 SCANNER</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&family=Share+Tech+Mono&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --neon-core: #39FF14;
            --neon-blue: #00D2FF;
            --neon-red: #FF003C;
            --panel-bg: rgba(2, 4, 8, 0.95);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { margin: 0; background: #000; color: #E0FFEE; font-family: 'Rajdhani', sans-serif; overflow: hidden; height: 100vh; width: 100vw; }

        #globe-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
        #globe-canvas { width: 100%; height: 100%; display: block; cursor: grab; }
        #globe-canvas:active { cursor: grabbing; }
        #labels-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }

        .filter-header {
            position: absolute; top: 20px; left: 20px; z-index: 2000;
            display: flex; gap: 8px; background: rgba(0,0,0,0.8); padding: 8px; border: 1px solid var(--neon-core);
        }
        .filter-btn {
            padding: 8px 15px; background: transparent; border: none; color: #444;
            font-family: 'Share Tech Mono'; font-size: 11px; cursor: pointer;
        }
        .filter-btn.active { color: var(--neon-core); background: rgba(57, 255, 20, 0.15); }
        .pause-btn { border-left: 1px solid #333; margin-left: 5px; color: var(--neon-red); }

        .globe-label {
            position: absolute; color: var(--neon-core); font-family: 'Share Tech Mono';
            font-size: 10px; text-transform: uppercase; pointer-events: none;
            text-shadow: 0 0 10px #000; transform: translate(-50%, -100%); opacity: 0;
        }

        #bottom-hud {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: var(--panel-bg); border-top: 2px solid var(--neon-core);
            z-index: 3000; transition: transform 0.5s ease;
        }
        #bottom-hud.collapsed { transform: translateY(calc(100% - 40px)); }

        .hud-toggle-bar { height: 40px; background: rgba(0,0,0,0.9); display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--neon-core); font-family: 'Orbitron'; font-size: 11px; }

        .hud-content { padding: 15px 30px; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; max-height: 40vh; overflow-y: auto; }
        .m-card { background: rgba(57, 255, 20, 0.05); padding: 8px; border: 1px solid rgba(57, 255, 20, 0.2); margin-bottom: 5px; }
        .m-val { font-size: 16px; font-weight: 700; font-family: 'Orbitron'; color: #FFF; }
        
        .scroll-window { flex-grow: 1; overflow-y: auto; border: 1px solid #222; background: rgba(0,0,0,0.4); height: 120px; }
        .data-table { width: 100%; font-family: 'Share Tech Mono'; font-size: 10px; border-collapse: collapse; }
        .data-table td { padding: 4px 8px; border-bottom: 1px solid #111; }

        /* LIVE FEED STYLING */
        #v-feed { font-family: 'Share Tech Mono'; font-size: 10px; cursor: pointer; }
        .feed-item { padding: 6px 15px; border-bottom: 1px solid #111; display: flex; justify-content: space-between; transition: 0.2s; }
        .feed-item:hover { background: rgba(57, 255, 20, 0.1); }
        .feed-item:active { background: var(--neon-core); color: #000; }
        .copy-alert { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--neon-core); color: #000; padding: 10px 20px; font-family: 'Orbitron'; font-weight: bold; display: none; z-index: 5000; border-radius: 4px; box-shadow: 0 0 20px var(--neon-core); }

        @media (max-width: 900px) { .hud-content { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <div class="copy-alert" id="copy-notify">SCAN SUCCESS // COPIED TO CLIPBOARD</div>

    <div id="globe-container">
        <div class="filter-header">
            <button class="filter-btn active" onclick="CORE.setFilter('ALL')">ALL</button>
            <button class="filter-btn" onclick="CORE.setFilter('RETAIL')">&lt; 100K</button>
            <button class="filter-btn" onclick="CORE.setFilter('WHALE')">&gt; 100K</button>
            <button class="filter-btn pause-btn" id="p-btn" onclick="CORE.togglePause()">PAUSE</button>
        </div>
        <canvas id="globe-canvas"></canvas>
        <div id="labels-container"></div>
    </div>

    <div id="bottom-hud" class="collapsed">
        <div class="hud-toggle-bar" onclick="UI.toggleHud()">
            NEXUS-15 GLOBAL SCANNER â–² (TAP FEED TO COPY FORENSICS)
        </div>
        <div class="hud-content">
            <div class="hud-section">
                <div class="m-card">
                    <div style="font-size:8px;color:#6FF">CAPTURED NATIVE VOL</div>
                    <div class="m-val" id="v-vol">0</div>
                </div>
                <div class="m-card">
                    <div style="font-size:8px;color:#6FF">XRP/USD INDEX</div>
                    <div class="m-val" id="v-price">2.0711</div>
                </div>
                <button class="filter-btn" style="width:100%; border:1px solid #333; margin-top:5px;" onclick="CORE.wipe()">WIPE MEMORY</button>
            </div>
            <div class="hud-section">
                <div class="scroll-window">
                    <table class="data-table">
                        <tbody id="v-geo"></tbody>
                    </table>
                </div>
            </div>
            <div class="hud-section">
                <div class="scroll-window" id="v-feed"></div>
            </div>
        </div>
    </div>

<script>
const CORE = {
    filter: 'ALL', paused: false,
    storage: { ALL: {vol:0, geo:{}}, RETAIL: {vol:0, geo:{}}, WHALE: {vol:0, geo:{}} },
    wallets: { 'rEb8TK3gBgY5auZkwPb6sotBDJHBXGcgf3':'BINANCE','rDsbeomaCcWiktR21Bg338node7pSpBwE':'BITSTAMP','rLHzPsXNmCukvR39zXkw9fC2n6jsh3U6m':'KRAKEN','rPVMhWB768H83C9N9pK9bL9r9bL9r9bL':'GATEHUB','rU2mEJSLqBRUYLVTvscMqcN9nd9mH6u':'UPBIT' },

    init() {
        const c = localStorage.getItem('nexus15_storage');
        if(c) this.storage = JSON.parse(c);
        this.render();
        this.link();
        this.price();
    },
    setFilter(f) { this.filter = f; this.render(); },
    togglePause() { this.paused = !this.paused; document.getElementById('p-btn').innerText = this.paused ? "RESUME" : "PAUSE"; },
    wipe() { if(confirm("CLEAR DATA?")) { localStorage.removeItem('nexus15_storage'); location.reload(); } },

    process(tx) {
        if(this.paused || typeof tx.Amount !== 'string') return;
        let xrp = Number(BigInt(tx.Amount)) / 1000000;
        if(xrp <= 0 || xrp > 100000000) return;

        const isW = xrp >= 100000;
        const nodeS = OPTICS.rnd(); const nodeD = OPTICS.rnd();

        const upd = (b) => {
            b.vol += xrp;
            if(!b.geo[nodeS.n]) b.geo[nodeS.n] = {in:0, out:0};
            if(!b.geo[nodeD.n]) b.geo[nodeD.n] = {in:0, out:0};
            b.geo[nodeS.n].out += xrp; b.geo[nodeD.n].in += xrp;
        };
        upd(this.storage.ALL);
        if(isW) upd(this.storage.WHALE); else upd(this.storage.RETAIL);

        if(this.filter === 'ALL' || (this.filter==='WHALE' && isW) || (this.filter==='RETAIL' && !isW)) {
            OPTICS.arc(nodeS, nodeD, xrp);
            UI.log(tx, xrp, isW);
            this.render();
        }
        localStorage.setItem('nexus15_storage', JSON.stringify(this.storage));
    },

    render() {
        const d = this.storage[this.filter];
        document.getElementById('v-vol').innerText = Math.floor(d.vol).toLocaleString();
        const tbody = document.getElementById('v-geo');
        const sorted = Object.keys(d.geo).sort((a,b) => d.geo[b].in - d.geo[a].in).slice(0,8);
        tbody.innerHTML = sorted.map(n => `<tr><td style="color:var(--neon-blue)">${n}</td><td style="color:#0f9">${d.geo[n].in.toFixed(0)}</td><td style="color:#f03">${d.geo[n].out.toFixed(0)}</td></tr>`).join('');
    },

    link() {
        const ws = new WebSocket('wss://xrplcluster.com');
        ws.onopen = () => ws.send(JSON.stringify({command:"subscribe", streams:["transactions"]}));
        ws.onmessage = (e) => { const res = JSON.parse(e.data); if(res.transaction) this.process(res.transaction); };
        ws.onclose = () => setTimeout(() => this.link(), 3000);
    },

    async price() {
        try {
            const r = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=XRPUSDT');
            const d = await r.json();
            if(d.price) document.getElementById('v-price').innerText = `$${parseFloat(d.price).toFixed(4)}`;
        } catch(e) { document.getElementById('v-price').innerText = "$2.0711"; }
    }
};

const OPTICS = {
    scene: null, camera: null, renderer: null, globe: null, nodes: [], controls: null, autoResumeTimer: null,
    init() {
        const c = document.getElementById('globe-container');
        this.scene = new THREE.Scene();
        this.camera = new THREE.PerspectiveCamera(75, c.offsetWidth/c.offsetHeight, 0.1, 2000);
        this.camera.position.z = 150;
        this.renderer = new THREE.WebGLRenderer({canvas:document.getElementById('globe-canvas'), antialias:true, alpha:true});
        this.renderer.setSize(c.offsetWidth, c.offsetHeight);
        
        this.controls = new THREE.OrbitControls(this.camera, this.renderer.domElement);
        this.controls.autoRotate = true;
        this.controls.autoRotateSpeed = 0.4;
        this.controls.enableDamping = true;

        // AUTO-RESUME LISTENER
        this.controls.addEventListener('start', () => {
            this.controls.autoRotate = false;
            clearTimeout(this.autoResumeTimer);
        });
        this.controls.addEventListener('end', () => {
            this.autoResumeTimer = setTimeout(() => { this.controls.autoRotate = true; }, 5000);
        });

        const sg = new THREE.BufferGeometry(); const sp = [];
        for(let i=0; i<4000; i++) sp.push((Math.random()-0.5)*1500, (Math.random()-0.5)*1500, (Math.random()-0.5)*1500);
        sg.setAttribute('position', new THREE.Float32BufferAttribute(sp, 3));
        this.scene.add(new THREE.Points(sg, new THREE.PointsMaterial({color:0xFFFFFF, size:0.7})));

        const tex = new THREE.TextureLoader().load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_atmos_2048.jpg');
        this.globe = new THREE.Mesh(new THREE.SphereGeometry(50, 64, 64), new THREE.MeshPhongMaterial({map:tex, color:0x2266ff, emissive:0x000211, shininess:35}));
        this.scene.add(this.globe);
        this.scene.add(new THREE.AmbientLight(0xffffff, 1.1));
        const sun = new THREE.DirectionalLight(0xffffff, 1); sun.position.set(100,100,100); this.scene.add(sun);
        
        const list = [{n:'USA',la:37,lo:-95},{n:'UK',la:55,lo:-2},{n:'JPN',la:36,lo:138},{n:'KOR',la:35,lo:127},{n:'UAE',la:25,lo:55},{n:'AUS',la:-25,lo:133}];
        const cont = document.getElementById('labels-container');
        list.forEach(n => {
            const pos = this.to3D(n.la, n.lo, 50.5);
            const dot = new THREE.Mesh(new THREE.SphereGeometry(1.4, 12, 12), new THREE.MeshBasicMaterial({color:0x39FF14}));
            dot.position.copy(pos); this.globe.add(dot);
            const div = document.createElement('div'); div.className='globe-label'; div.textContent=n.n; cont.appendChild(div);
            this.nodes.push({el:div, obj:dot, n:n.n, la:n.la, lo:n.lo});
        });
        this.loop();
    },
    rnd() { return this.nodes[Math.floor(Math.random()*this.nodes.length)]; },
    to3D(la, lo, r) {
        const phi = (90-la)*(Math.PI/180), th = (lo+180)*(Math.PI/180);
        return new THREE.Vector3(-(r*Math.sin(phi)*Math.cos(th)), r*Math.cos(phi), r*Math.sin(phi)*Math.sin(th));
    },
    arc(f, t, a) {
        const p1 = this.to3D(f.la, f.lo, 50); const p2 = this.to3D(t.la, t.lo, 50);
        const curve = new THREE.QuadraticBezierCurve3(p1, new THREE.Vector3().addVectors(p1, p2).normalize().multiplyScalar(a>=100000 ? 85 : 65), p2);
        const geo = new THREE.BufferGeometry().setFromPoints(curve.getPoints(50));
        const mat = new THREE.LineBasicMaterial({color:a>=100000 ? 0xFF003C : (a>=10000?0x00D2FF:0x39FF14), transparent:true, opacity:1, blending:THREE.AdditiveBlending});
        const line = new THREE.Line(geo, mat); this.globe.add(line);
        let p = 0, fade = false;
        const anim = () => {
            if(CORE.paused) { requestAnimationFrame(anim); return; }
            if(!fade) { p += 0.04; geo.setDrawRange(0, Math.floor(p*50)); if(p>=1) fade=true; }
            else { mat.opacity -= 0.005; if(mat.opacity<=0) { this.globe.remove(line); geo.dispose(); return; } }
            requestAnimationFrame(anim);
        };
        anim();
    },
    loop() {
        requestAnimationFrame(() => this.loop());
        this.controls.update();
        this.nodes.forEach(n => {
            const wp = new THREE.Vector3(); n.obj.getWorldPosition(wp);
            const v = this.camera.position.clone().sub(wp).normalize();
            if(wp.clone().normalize().dot(v) < 0.1) n.el.style.opacity = 0;
            else {
                wp.project(this.camera);
                const x = (wp.x*.5+.5)*document.getElementById('globe-container').clientWidth;
                const y = (wp.y*-.5+.5)*document.getElementById('globe-container').clientHeight;
                n.el.style.opacity = 1; n.el.style.transform = `translate(-50%,-100%) translate(${x}px,${y}px)`;
            }
        });
        this.renderer.render(this.scene, this.camera);
    }
};

const UI = {
    toggleHud() { document.getElementById('bottom-hud').classList.toggle('collapsed'); },
    log(tx, a, isW) {
        const f = document.getElementById('v-feed');
        const d = document.createElement('div'); d.className='feed-item';
        d.innerHTML = `<span>[${new Date().toLocaleTimeString()}]</span><span>${a.toLocaleString()} XRP</span>`;
        // ATTACH FORENSIC DATA FOR COPY
        d.onclick = () => {
            const forensicData = `HASH: ${tx.hash}\nSENDER: ${tx.Account}\nDESTINATION: ${tx.Destination || 'N/A'}\nAMOUNT: ${a} XRP`;
            const el = document.createElement('textarea');
            el.value = forensicData; document.body.appendChild(el); el.select();
            document.execCommand('copy'); document.body.removeChild(el);
            const notify = document.getElementById('copy-notify');
            notify.style.display = 'block'; setTimeout(() => notify.style.display = 'none', 1500);
        };
        if(f.children.length>40) f.removeChild(f.lastChild);
        f.insertBefore(d, f.firstChild);
    }
};

document.addEventListener('DOMContentLoaded', () => { OPTICS.init(); CORE.init(); });
window.addEventListener('resize', () => {
    const c = document.getElementById('globe-container');
    OPTICS.camera.aspect = c.offsetWidth / c.offsetHeight;
    OPTICS.camera.updateProjectionMatrix();
    OPTICS.renderer.setSize(c.offsetWidth, c.offsetHeight);
});
</script>
</body>
</html>